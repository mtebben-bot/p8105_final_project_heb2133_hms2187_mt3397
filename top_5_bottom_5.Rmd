---
title: "Top 5 Countries"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

As a part of our exploratory analyses, we wanted to examine the relationship between human freedom scores and happiness scores for the highest scoring and lowest scoring countries for each metric. We also wanted to look at the subcomponents of the human freedom scores to see if the top scoring or lowest scoring countries had similarities across these metrics. Below, you will find the tabs for each metric with analysis of the 5 highest and 5 lowest scoring countries for that given metric.

```{r setup, include = F}
library(tidyverse)
library(readxl)
library(patchwork)
library(ggrepel)
library(plotly)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r, warning = F, message = F, include = F}
top5_bot5_df = 
  read_csv("./data/merged_df.csv") %>%
  drop_na(happiness_score, human_freedom_score) %>% 
  select(countries:economic_freedom_score)
```

```{r, include = F}
bot5_whr = 
  top5_bot5_df %>% 
  arrange(happiness_score) %>% 
  top_n(happiness_score, n = -5)

bot5_whr %>% 
  summarize(bot5_WHR_average = mean(happiness_score),
            bot5_WHR_sd = sd(happiness_score),
            bot5_HFI_average = mean(human_freedom_score),
            bot5_HFI_sd = sd(human_freedom_score))
```

```{r, include = F}
top5_whr = 
  top5_bot5_df %>% 
  arrange(happiness_score) %>% 
  top_n(happiness_score, n = 5) %>% 
  arrange(desc(happiness_score))

top5_whr %>% 
  summarize(top5_WHR_average = mean(happiness_score),
            top5_HFI_average = mean(human_freedom_score))

```

```{r, include = F}
top5_hfi = 
  top5_bot5_df %>% 
  select(countries, human_freedom_score, everything()) %>% 
  arrange(human_freedom_score) %>% 
  top_n(human_freedom_score, n = 5) %>% 
  arrange(desc(human_freedom_score)) 

top5_hfi %>% 
  summarize(top5_HFI_average = mean(human_freedom_score),
            top5_WHR_average = mean(happiness_score))
```

```{r, include = F}
bot5_hfi = 
  top5_bot5_df %>% 
  select(countries, human_freedom_score, everything()) %>%
  arrange(human_freedom_score) %>% 
  top_n(human_freedom_score, n = -5) 

bot5_hfi %>% 
  summarize(bot5_HFI_average = mean(human_freedom_score),
            bot5_WHR_average = mean(happiness_score))
```

## Examining Differences and Similarities between the Top 5 and Bottom 5 Country Scores {.tabset}


### Human Freedom Index Scores

#### Bottom 5 Countries for Human Freedom Scores
```{r, echo = F}
bot5_hfi %>% knitr::kable()
```

As we can see here, the countries with the five lowest human freedom scores have some variety in their happiness scores.

```{r, echo = F}
top5_hfi %>% knitr::kable()
```

Insert comments on top 5 hfi



```{r, message = F, warning = F}
hfi_combo = full_join(bot5_hfi, top5_hfi)

hfi_combo %>% 
  mutate(text_label = str_c(countries, "\nFreedom Score:", human_freedom_score, "\nHappiness Score: ", happiness_score)) %>%
  plot_ly(x = ~ human_freedom_score, y = ~happiness_score, type = "scatter", mode = "markers", size = 3, alpha = 0.5, color = ~countries, text = ~text_label, colors = "viridis") %>% 
  layout( title = "Plot of Human Freedom Scores against Happiness Scores for the Top 5 and Bottom 5 Human Freedom Scoring Countries",
      xaxis = list(title = "Human Freedom Score"),
      yaxis = list(title = "Happiness Score")
    )

```

Insert comments about the plot hfi

### Happiness Scores

```{r, echo = F}
bot5_whr %>% knitr::kable()
```

Insert comments about bot 5 whr

```{r, echo = F}
top5_whr %>% knitr::kable()
```

Insert comments about top 5 whr

```{r, message = F, warning=F}
whr_combo = full_join(bot5_whr, top5_whr)

whr_combo %>% 
  mutate(text_label = str_c(countries, "\nHappiness Score: ", happiness_score, "\nFreedom Score:", human_freedom_score)) %>%
  plot_ly(x = ~happiness_score, y = ~human_freedom_score, type = "scatter", mode = "markers", size = 3, alpha = 0.5, color = ~countries, text = ~text_label, colors = "viridis") %>% 
  layout( title = "Plot of Happiness Scores Against Human Freedom Scores for the Top 5 and Bottom 5 Happiness Scoring Countries",
      xaxis = list(title = "Happiness Score"),
      yaxis = list(title = "Human Freedom Score")
    )
```

Insert comments about whr plot
